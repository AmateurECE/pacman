pkgname="libgobiautomata"
pkgver="0.2.0"
pkgrel="1"
pkgdesc="Simple finite state automaton framework in C"
arch=("any")
license=("MIT")
source=("https://github.com/AmateurECE/libgobiautomata/archive/refs/tags/v$pkgver.tar.gz")
sha256sums=('e62b3f5bb59ab7b9c800e221927ed9526d44b4b5525f1a25884497fdd5052eed')
makedepends=("meson")
url="https://github.com/AmateurECE/libgobiautomata"
groups=("edtwardy")

prepare() {
    tar xzf v$pkgver.tar.gz
}

lib_name=$pkgname.so.$pkgver
build() {
    (cd $pkgname-$pkgver &&
         meson setup --prefix /usr -Dbuildtype=release ../build)
    (cd build &&
         ninja &&
         objcopy --only-keep-debug $lib_name $pkgname.debug &&
         strip --strip-debug --strip-unneeded $lib_name &&
         objcopy --add-gnu-debuglink=$pkgname.debug $lib_name)
}

package() {
    (cd build &&
         meson install --destdir=$pkgdir &&
         install -Dm644 $pkgname.debug $pkgdir/usr/lib/debug/$pkgname.debug)
}
